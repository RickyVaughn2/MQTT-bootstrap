angular.module("Mqtt.Controls",["Mqtt.Services"]),angular.module("Mqtt.Controls").directive("mqttBar",function(){return{restrict:"E",scope:{},controller:["$scope","mqtt",function(a,b){a.connect=function(a,c,d,e,f,g,h){b.connect(a,c,d,e,f),b.subscribe(g,h,a,c,d,e,f)},a.chart=void 0,a.uniqueId="myChart"+a.$id}],link:function(a,b,c,d){a.connect(c.host,parseInt(c.port),c.user,c.pass,"true"==c.useSsl,c.topic,function(b){var c,d=b.destinationName;if(b.payloadString.indexOf("=")>0){var e=b.payloadString.split("="),d=e[0];c=parseFloat(e[1])}else c=parseFloat(b.payloadString);var f=document.getElementById(a.uniqueId).getContext("2d");if(void 0==a.chart)a.chart=new Chart(f).Bar({labels:[d],datasets:[{label:"main",fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:[c]}]},{animationSteps:50});else{for(var g=!1,h=0;h<a.chart.datasets[0].bars.length;h++){var i=a.chart.datasets[0].bars[h];i.label==d&&(g=!0,i.value=c)}g||a.chart.addData([c],d),a.chart.update()}a.$apply()})},replace:!0,template:"<canvas id='{{::uniqueId}}' width='400' height='400'></canvas>"}}),angular.module("Mqtt.Controls").directive("mqttDoughnut",function(){return{restrict:"E",scope:{},controller:["$scope","mqtt",function(a,b){a.connect=function(a,c,d,e,f,g,h){b.connect(a,c,d,e,f),b.subscribe(g,h,a,c,d,e,f)},a.chart=void 0,a.uniqueId="myChart"+a.$id}],link:function(a,b,c,d){var e=c.maxValue;a.connect(c.host,parseInt(c.port),c.user,c.pass,"true"==c.useSsl,c.topic,function(b){var c,d=b.destinationName;if(b.payloadString.indexOf("=")>0){var f=b.payloadString.split("="),d=f[0];c=parseFloat(f[1])}else c=parseFloat(b.payloadString);var g=document.getElementById(a.uniqueId).getContext("2d");if(void 0==e&&(e=1.2*parseInt(c)),void 0==a.chart)a.chart=new Chart(g).Doughnut([{value:c,color:"#46BFBD",highlight:"#5AD3D1",label:d},{value:e-c,color:"#FFFFFF",highlight:"#FFFFFF",label:"empty"}],{animationSteps:50});else{for(var h=0,i=!1,j=-1,k=0;k<a.chart.segments.length;k++){var l=a.chart.segments[k];l.label==d&&(l.value=c,i=!0),"empty"!=l.label?h+=a.chart.segments[k].value:j=k}i||(a.chart.addData({value:c,color:"#46BFBD",highlight:"#5AD3D1",label:d}),h+=c),a.chart.segments[j].value=e-h,a.chart.update()}a.$apply()})},replace:!0,template:"<canvas id='{{::uniqueId}}' width='400' height='400'></canvas>"}}),angular.module("Mqtt.Controls").directive("mqttPublisher",function(){return{restrict:"E",scope:{},controller:["$scope","mqtt",function(a,b){var c,d,e,f,g,h;a.connect=function(a,i,j,k,l,m,n){b.connect(a,i,j,k,l),b.subscribe(m,n,a,i,j,k,l),c=a,d=i,e=j,f=k,g=l,h=m},a.chart=void 0,a.uniqueId="myPub"+a.$id,a.sendMessage=function(){b.sendMessage(document.getElementById(a.uniqueId).value,h,c,d,e,f,g)}}],link:function(a,b,c,d){c.maxValue;a.connect(c.host,parseInt(c.port),c.user,c.pass,"true"==c.useSsl,c.topic,function(b){var c=b.payloadString;document.getElementById(a.uniqueId).value=c,a.$apply()})},replace:!0,template:"<form ng-submit='sendMessage()'>	<input type='text' id='{{::uniqueId}}'></input>	<input type='submit' value='Publish' /></form>"}}),angular.module("Mqtt.Controls").directive("mqttOnOffSwitch",function(){return{restrict:"E",scope:{},controller:["$scope","mqtt",function(a,b){var c,d,e,f,g,h;a.connect=function(a,i,j,k,l,m,n){b.connect(a,i,j,k,l),b.subscribe(m,n,a,i,j,k,l),c=a,d=i,e=j,f=k,g=l,h=m},a.chart=void 0,a.uniqueId="myChk"+a.$id,a.sendMessage=function(){b.sendMessage(document.getElementById(a.uniqueId).checked?"on":"off",h,c,d,e,f,g)}}],link:function(a,b,c,d){c.maxValue;a.connect(c.host,parseInt(c.port),c.user,c.pass,"true"==c.useSsl,c.topic,function(b){var c=b.payloadString;document.getElementById(a.uniqueId).checked="on"==c,a.$apply()}),a.topic=c.topic},replace:!0,template:"<form action='.'>	<input type='checkbox' id='{{::uniqueId}}' ng-click='sendMessage()'></input> <label for='{{::uniqueId}}'>{{topic}}</label></form>"}});