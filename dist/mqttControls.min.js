angular.module("Mqtt.Controls",["Mqtt.Services"]).directive("mqttPanel",function(){return{restrict:"E",scope:{},controller:["$scope","mqtt","$rootScope",function(a,b,c){a.host="",a.port=0,a.user="",a.pass="",a.useSSL=!1,a.clientId,this.connect=function(c,d){b.connect(a.host,a.port,a.user,a.pass,a.useSSL,a.clientId),b.subscribe(c,d,a.host,a.port,a.user,a.pass,a.useSSL,a.clientId)},this.sendMessage=function(c,d){b.sendMessage(d,c,a.host,a.port,a.user,a.pass,a.useSSL)},this.ready=function(){a.$broadcast("ready-to-connect",{})}}],link:function(a,b,c,d){a.host=c.host,a.port=parseInt(c.port),a.user=c.user,a.pass=c.password,a.useSSL="true"==c.useSsl,a.clientId=c.clientId,d.ready()},transclude:!0,template:"<div ng-transclude></div>",replace:!0}}),angular.module("Mqtt.Controls").directive("mqttBar",function(){return{restrict:"E",scope:{},require:"^?mqttPanel",controller:["$scope","mqtt",function(a,b){a.connect=function(a,c,d,e,f,g,h,i){b.connect(a,c,d,e,f,h),b.subscribe(g,i,a,c,d,e,f)},a.uniqueId="myChart"+a.$id}],link:function(a,b,c,d){var e=function(b){void 0!=c.transform&&void 0!=window[c.transform]&&(msg=window[c.transform](b.payloadString));var d,e=b.destinationName;if(msg.indexOf("=")>0){var f=msg.split("="),e=f[0].trim();d=parseFloat(f[1].trim())}else d=parseFloat(msg);if(e.length>40&&(e=e.substring(0,40)+"..."),void 0==a.chart){var g=document.getElementById(a.uniqueId).getContext("2d");a.chart=new Chart(g).Bar({labels:[e],datasets:[{label:"main",fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:[d]}]},{animationSteps:50})}else{for(var h=!1,i=0;i<a.chart.datasets[0].bars.length;i++){var j=a.chart.datasets[0].bars[i];j.label==e&&(h=!0,j.value=d)}h||a.chart.addData([d],e),a.chart.update()}a.$apply()};c.host&&c.host.length?a.connect(c.host,parseInt(c.port),c.user,c.password,"true"==c.useSsl,c.topic,c.clientId,e):void 0!=d&&a.$on("ready-to-connect",function(a,b){d.connect(c.topic,e)})},replace:!0,template:'<canvas id="{{::uniqueId}}"></canvas>'}}),angular.module("Mqtt.Controls").directive("mqttDoughnut",function(){return{restrict:"E",scope:{},require:"^?mqttPanel",controller:["$scope","mqtt",function(a,b){a.connect=function(a,c,d,e,f,g,h,i){b.connect(a,c,d,e,f,h),b.subscribe(g,i,a,c,d,e,f)},a.uniqueId="myChart"+a.$id}],link:function(a,b,c,d){var e=c.maxValue,f=function(b){var d;void 0!=c.transform&&void 0!=window[c.transform]&&(d=window[c.transform](b.payloadString));var f,g=b.destinationName;if(d.indexOf("=")>0){var h=d.split("="),g=h[0];f=parseFloat(h[1])}else f=parseFloat(d);var i=document.getElementById(a.uniqueId).getContext("2d");if(void 0==e&&(e=1.2*parseInt(f)),void 0==a.chart)a.chart=new Chart(i).Doughnut([{value:f,color:"#46BFBD",highlight:"#5AD3D1",label:g},{value:e-f,color:"#FFFFFF",highlight:"#FFFFFF",label:"empty"}],{animationSteps:50});else{for(var j=0,k=!1,l=-1,m=0;m<a.chart.segments.length;m++){var n=a.chart.segments[m];n.label==g&&(n.value=f,k=!0),"empty"!=n.label?j+=a.chart.segments[m].value:l=m}k||(a.chart.addData({value:f,color:"#46BFBD",highlight:"#5AD3D1",label:g}),j+=f),a.chart.segments[l].value=e-j,a.chart.update()}a.$apply()};c.host&&c.host.length?a.connect(c.host,parseInt(c.port),c.user,c.password,"true"==c.useSsl,c.topic,c.clientId,f):void 0!=d&&a.$on("ready-to-connect",function(a,b){d.connect(c.topic,f)})},replace:!0,template:'<canvas id="{{::uniqueId}}"></canvas>'}}),angular.module("Mqtt.Controls").directive("mqttPublisher",function(){return{restrict:"E",scope:{},require:"^?mqttPanel",controller:["$scope","mqtt",function(a,b){var c,d,e,f,g,h;a.connect=function(a,i,j,k,l,m,n,o){b.connect(a,i,j,k,l,n),b.subscribe(m,o,a,i,j,k,l),c=a,d=i,e=j,f=k,g=l,h=m},a.sendMessage=function(){b.sendMessage(document.getElementById(a.uniqueId).value,h,c,d,e,f,g)},a.chart=void 0,a.uniqueId="myPub"+a.$id}],link:function(a,b,c,d){var e=function(b){var c=b.payloadString;document.getElementById(a.uniqueId).value=c,a.$apply()};c.host&&c.host.length?a.connect(c.host,parseInt(c.port),c.user,c.password,"true"==c.useSsl,c.topic,c.clientId,e):void 0!=d&&a.$on("ready-to-connect",function(b,f){d.connect(c.topic,e),a.sendMessage=function(){d.sendMessage(c.topic,document.getElementById(a.uniqueId).value)}})},replace:!0,template:'<form ng-submit="sendMessage()">  <input type="text" id="{{::uniqueId}}"></input>  <input type="submit" value="Publish" /></form>'}}),angular.module("Mqtt.Controls").directive("mqttOnOffSwitch",function(){return{restrict:"E",scope:{host:"="},require:"^?mqttPanel",controller:["$scope","mqtt",function(a,b){var c,d,e,f,g,h;a.connect=function(a,i,j,k,l,m,n,o){b.connect(a,i,j,k,l,n),b.subscribe(m,o,a,i,j,k,l),c=a,d=i,e=j,f=k,g=l,h=m},a.sendMessage=function(){b.sendMessage(document.getElementById(a.uniqueId).checked?"on":"off",h,c,d,e,f,g)},a.chart=void 0,a.uniqueId="myChk"+a.$id}],link:function(a,b,c,d){var e=function(b){var d=b.payloadString;void 0!=c.transform&&void 0!=window[c.transform]&&(d=window[c.transform](d)),document.getElementById(a.uniqueId).checked="on"==d,a.$apply()};a.topic=c.topic,c.host&&c.host.length?a.connect(c.host,parseInt(c.port),c.user,c.password,"true"==c.useSsl,c.topic,c.clientId,e):void 0!=d&&a.$on("ready-to-connect",function(b,f){d.connect(c.topic,e),a.sendMessage=function(){d.sendMessage(c.topic,document.getElementById(a.uniqueId).checked?"on":"off")}})},replace:!0,template:'<form action=".">	<input type="checkbox" id="{{::uniqueId}}" ng-click="sendMessage()"></input> <label for="{{::uniqueId}}">{{topic}}</label></form>'}}),angular.module("Mqtt.Controls").directive("mqttTimeSeries",function(){return{restrict:"E",scope:{},require:"^?mqttPanel",controller:["$scope","mqtt",function(a,b){a.connect=function(a,c,d,e,f,g,h,i){b.connect(a,c,d,e,f,h),b.subscribe(g,i,a,c,d,e,f)},a.chart=void 0,a.uniqueId="myChart"+a.$id}],link:function(a,b,c,d){var e=20;c.maxPoints&&!isNaN(parseInt(c.maxPoints))&&(e=parseInt(c.maxPoints));var f=500;c.interval&&!isNaN(parseInt(c.interval))&&(f=parseInt(c.interval)),a.curValue=0;var g=function(b){void 0!=c.transform&&void 0!=window[c.transform]&&(msg=window[c.transform](b.payloadString)),h=parseFloat(msg),a.curValue=h},h=0;setInterval(function(){var b=document.getElementById(a.uniqueId).getContext("2d");void 0==a.chart?a.chart=new Chart(b).Line({labels:[getDate()],datasets:[{label:"main",fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:[h]}]},{animationSteps:50}):(a.chart.addData([h],getDate()),a.chart.datasets[0].points.length>e&&a.chart.removeData(),a.chart.update()),a.$apply()},f),c.host&&c.host.length?a.connect(c.host,parseInt(c.port),c.user,c.password,"true"==c.useSsl,c.topic,c.clientId,g):void 0!=d&&a.$on("ready-to-connect",function(a,b){d.connect(c.topic,g)})},replace:!0,template:'<canvas id="{{::uniqueId}}"></canvas>'}});var getDate=function(){var a=new Date,b=a.getHours()+":"+(a.getMinutes()<10?"0"+a.getMinutes():""+a.getMinutes())+":"+(a.getSeconds()<10?"0"+a.getSeconds():""+a.getSeconds());return b};angular.module("Mqtt.Controls").directive("mqttLabel",function(){return{restrict:"E",scope:{},require:"^?mqttPanel",controller:["$scope","mqtt",function(a,b){a.connect=function(a,c,d,e,f,g,h,i){b.connect(a,c,d,e,f,h),b.subscribe(g,i,a,c,d,e,f)},a.uniqueId="myPub"+a.$id}],link:function(a,b,c,d){var e=function(b){var d=b.payloadString;void 0!=c.transform&&void 0!=window[c.transform]&&(d=window[c.transform](b.payloadString)),document.getElementById(a.uniqueId).innerHTML=d,a.$apply()};c.host&&c.host.length?a.connect(c.host,parseInt(c.port),c.user,c.password,"true"==c.useSsl,c.topic,c.clientId,e):void 0!=d&&a.$on("ready-to-connect",function(a,b){d.connect(c.topic,e)})},replace:!0,template:'<span id="{{::uniqueId}}"></span>'}});